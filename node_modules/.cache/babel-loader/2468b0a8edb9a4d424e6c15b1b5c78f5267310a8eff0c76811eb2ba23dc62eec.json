{"ast":null,"code":"exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\nvar _ = require(\"underscore\");\nvar documents = require(\"../documents\");\nvar Result = require(\"../results\").Result;\nvar warning = require(\"../results\").warning;\nvar xml = require(\"../xml\");\nvar uris = require(\"./uris\");\nfunction createBodyReader(options) {\n  return {\n    readXmlElement: function (element) {\n      return new BodyReader(options).readXmlElement(element);\n    },\n    readXmlElements: function (elements) {\n      return new BodyReader(options).readXmlElements(elements);\n    }\n  };\n}\nfunction BodyReader(options) {\n  var complexFieldStack = [];\n  var currentInstrText = [];\n\n  // When a paragraph is marked as deleted, its contents should be combined\n  // with the following paragraph. See 17.13.5.15 del (Deleted Paragraph) of\n  // ECMA-376 4th edition Part 1.\n  var deletedParagraphContents = [];\n  var relationships = options.relationships;\n  var contentTypes = options.contentTypes;\n  var docxFile = options.docxFile;\n  var files = options.files;\n  var numbering = options.numbering;\n  var styles = options.styles;\n  function readXmlElements(elements) {\n    var results = elements.map(readXmlElement);\n    return combineResults(results);\n  }\n  function readXmlElement(element) {\n    if (element.type === \"element\") {\n      var handler = xmlElementReaders[element.name];\n      if (handler) {\n        return handler(element);\n      } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n        var message = warning(\"An unrecognised element was ignored: \" + element.name);\n        return emptyResultWithMessages([message]);\n      }\n    }\n    return emptyResult();\n  }\n  function readParagraphProperties(element) {\n    return readParagraphStyle(element).map(function (style) {\n      return {\n        type: \"paragraphProperties\",\n        styleId: style.styleId,\n        styleName: style.name,\n        alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n        numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n        indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n      };\n    });\n  }\n  function readParagraphIndent(element) {\n    return {\n      start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n      end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n      firstLine: element.attributes[\"w:firstLine\"],\n      hanging: element.attributes[\"w:hanging\"]\n    };\n  }\n  function readRunProperties(element) {\n    return readRunStyle(element).map(function (style) {\n      var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"];\n      // w:sz gives the font size in half points, so halve the value to get the size in points\n      var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n      return {\n        type: \"runProperties\",\n        styleId: style.styleId,\n        styleName: style.name,\n        verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n        font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n        fontSize: fontSize,\n        isBold: readBooleanElement(element.first(\"w:b\")),\n        isUnderline: readUnderline(element.first(\"w:u\")),\n        isItalic: readBooleanElement(element.first(\"w:i\")),\n        isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n        isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n        isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\")),\n        highlight: readHighlightValue(element.firstOrEmpty(\"w:highlight\").attributes[\"w:val\"])\n      };\n    });\n  }\n  function readUnderline(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== undefined && value !== \"false\" && value !== \"0\" && value !== \"none\";\n    } else {\n      return false;\n    }\n  }\n  function readBooleanElement(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== \"false\" && value !== \"0\";\n    } else {\n      return false;\n    }\n  }\n  function readBooleanAttributeValue(value) {\n    return value !== \"false\" && value !== \"0\";\n  }\n  function readHighlightValue(value) {\n    if (!value || value === \"none\") {\n      return null;\n    } else {\n      return value;\n    }\n  }\n  function readParagraphStyle(element) {\n    return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n  }\n  function readRunStyle(element) {\n    return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n  }\n  function readTableStyle(element) {\n    return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n  }\n  function readStyle(element, styleTagName, styleType, findStyleById) {\n    var messages = [];\n    var styleElement = element.first(styleTagName);\n    var styleId = null;\n    var name = null;\n    if (styleElement) {\n      styleId = styleElement.attributes[\"w:val\"];\n      if (styleId) {\n        var style = findStyleById(styleId);\n        if (style) {\n          name = style.name;\n        } else {\n          messages.push(undefinedStyleWarning(styleType, styleId));\n        }\n      }\n    }\n    return elementResultWithMessages({\n      styleId: styleId,\n      name: name\n    }, messages);\n  }\n  function readFldChar(element) {\n    var type = element.attributes[\"w:fldCharType\"];\n    if (type === \"begin\") {\n      complexFieldStack.push({\n        type: \"begin\",\n        fldChar: element\n      });\n      currentInstrText = [];\n    } else if (type === \"end\") {\n      var complexFieldEnd = complexFieldStack.pop();\n      if (complexFieldEnd.type === \"begin\") {\n        complexFieldEnd = parseCurrentInstrText(complexFieldEnd);\n      }\n      if (complexFieldEnd.type === \"checkbox\") {\n        return elementResult(documents.checkbox({\n          checked: complexFieldEnd.checked\n        }));\n      }\n    } else if (type === \"separate\") {\n      var complexFieldSeparate = complexFieldStack.pop();\n      var complexField = parseCurrentInstrText(complexFieldSeparate);\n      complexFieldStack.push(complexField);\n    }\n    return emptyResult();\n  }\n  function currentHyperlinkOptions() {\n    var topHyperlink = _.last(complexFieldStack.filter(function (complexField) {\n      return complexField.type === \"hyperlink\";\n    }));\n    return topHyperlink ? topHyperlink.options : null;\n  }\n  function parseCurrentInstrText(complexField) {\n    return parseInstrText(currentInstrText.join(''), complexField.type === \"begin\" ? complexField.fldChar : xml.emptyElement);\n  }\n  function parseInstrText(instrText, fldChar) {\n    var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(instrText);\n    if (externalLinkResult) {\n      return {\n        type: \"hyperlink\",\n        options: {\n          href: externalLinkResult[1]\n        }\n      };\n    }\n    var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(instrText);\n    if (internalLinkResult) {\n      return {\n        type: \"hyperlink\",\n        options: {\n          anchor: internalLinkResult[1]\n        }\n      };\n    }\n    var checkboxResult = /\\s*FORMCHECKBOX\\s*/.exec(instrText);\n    if (checkboxResult) {\n      var checkboxElement = fldChar.firstOrEmpty(\"w:ffData\").firstOrEmpty(\"w:checkBox\");\n      var checkedElement = checkboxElement.first(\"w:checked\");\n      var checked = checkedElement == null ? readBooleanElement(checkboxElement.first(\"w:default\")) : readBooleanElement(checkedElement);\n      return {\n        type: \"checkbox\",\n        checked: checked\n      };\n    }\n    return {\n      type: \"unknown\"\n    };\n  }\n  function readInstrText(element) {\n    currentInstrText.push(element.text());\n    return emptyResult();\n  }\n  function readSymbol(element) {\n    // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n    var font = element.attributes[\"w:font\"];\n    var char = element.attributes[\"w:char\"];\n    var unicodeCharacter = dingbatToUnicode.hex(font, char);\n    if (unicodeCharacter == null && /^F0..$/.test(char)) {\n      unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n    }\n    if (unicodeCharacter == null) {\n      return emptyResultWithMessages([warning(\"A w:sym element with an unsupported character was ignored: char \" + char + \" in font \" + font)]);\n    } else {\n      return elementResult(new documents.Text(unicodeCharacter.string));\n    }\n  }\n  function noteReferenceReader(noteType) {\n    return function (element) {\n      var noteId = element.attributes[\"w:id\"];\n      return elementResult(new documents.NoteReference({\n        noteType: noteType,\n        noteId: noteId\n      }));\n    };\n  }\n  function readCommentReference(element) {\n    return elementResult(documents.commentReference({\n      commentId: element.attributes[\"w:id\"]\n    }));\n  }\n  function readChildElements(element) {\n    return readXmlElements(element.children);\n  }\n  var xmlElementReaders = {\n    \"w:p\": function (element) {\n      var paragraphPropertiesElement = element.firstOrEmpty(\"w:pPr\");\n      var isDeleted = !!paragraphPropertiesElement.firstOrEmpty(\"w:rPr\").first(\"w:del\");\n      if (isDeleted) {\n        element.children.forEach(function (child) {\n          deletedParagraphContents.push(child);\n        });\n        return emptyResult();\n      } else {\n        var childrenXml = element.children;\n        if (deletedParagraphContents.length > 0) {\n          childrenXml = deletedParagraphContents.concat(childrenXml);\n          deletedParagraphContents = [];\n        }\n        return ReadResult.map(readParagraphProperties(paragraphPropertiesElement), readXmlElements(childrenXml), function (properties, children) {\n          return new documents.Paragraph(children, properties);\n        }).insertExtra();\n      }\n    },\n    \"w:r\": function (element) {\n      return ReadResult.map(readRunProperties(element.firstOrEmpty(\"w:rPr\")), readXmlElements(element.children), function (properties, children) {\n        var hyperlinkOptions = currentHyperlinkOptions();\n        if (hyperlinkOptions !== null) {\n          children = [new documents.Hyperlink(children, hyperlinkOptions)];\n        }\n        return new documents.Run(children, properties);\n      });\n    },\n    \"w:fldChar\": readFldChar,\n    \"w:instrText\": readInstrText,\n    \"w:t\": function (element) {\n      return elementResult(new documents.Text(element.text()));\n    },\n    \"w:tab\": function (element) {\n      return elementResult(new documents.Tab());\n    },\n    \"w:noBreakHyphen\": function () {\n      return elementResult(new documents.Text(\"\\u2011\"));\n    },\n    \"w:softHyphen\": function (element) {\n      return elementResult(new documents.Text(\"\\u00AD\"));\n    },\n    \"w:sym\": readSymbol,\n    \"w:hyperlink\": function (element) {\n      var relationshipId = element.attributes[\"r:id\"];\n      var anchor = element.attributes[\"w:anchor\"];\n      return readXmlElements(element.children).map(function (children) {\n        function create(options) {\n          var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n          return new documents.Hyperlink(children, _.extend({\n            targetFrame: targetFrame\n          }, options));\n        }\n        if (relationshipId) {\n          var href = relationships.findTargetByRelationshipId(relationshipId);\n          if (anchor) {\n            href = uris.replaceFragment(href, anchor);\n          }\n          return create({\n            href: href\n          });\n        } else if (anchor) {\n          return create({\n            anchor: anchor\n          });\n        } else {\n          return children;\n        }\n      });\n    },\n    \"w:tbl\": readTable,\n    \"w:tr\": readTableRow,\n    \"w:tc\": readTableCell,\n    \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n    \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n    \"w:commentReference\": readCommentReference,\n    \"w:br\": function (element) {\n      var breakType = element.attributes[\"w:type\"];\n      if (breakType == null || breakType === \"textWrapping\") {\n        return elementResult(documents.lineBreak);\n      } else if (breakType === \"page\") {\n        return elementResult(documents.pageBreak);\n      } else if (breakType === \"column\") {\n        return elementResult(documents.columnBreak);\n      } else {\n        return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n      }\n    },\n    \"w:bookmarkStart\": function (element) {\n      var name = element.attributes[\"w:name\"];\n      if (name === \"_GoBack\") {\n        return emptyResult();\n      } else {\n        return elementResult(new documents.BookmarkStart({\n          name: name\n        }));\n      }\n    },\n    \"mc:AlternateContent\": function (element) {\n      return readChildElements(element.first(\"mc:Fallback\"));\n    },\n    \"w:sdt\": function (element) {\n      var checkbox = element.firstOrEmpty(\"w:sdtPr\").first(\"wordml:checkbox\");\n      if (checkbox) {\n        var checkedElement = checkbox.first(\"wordml:checked\");\n        var isChecked = !!checkedElement && readBooleanAttributeValue(checkedElement.attributes[\"wordml:val\"]);\n        return elementResult(documents.checkbox({\n          checked: isChecked\n        }));\n      } else {\n        return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n      }\n    },\n    \"w:ins\": readChildElements,\n    \"w:object\": readChildElements,\n    \"w:smartTag\": readChildElements,\n    \"w:drawing\": readChildElements,\n    \"w:pict\": function (element) {\n      return readChildElements(element).toExtra();\n    },\n    \"v:roundrect\": readChildElements,\n    \"v:shape\": readChildElements,\n    \"v:textbox\": readChildElements,\n    \"w:txbxContent\": readChildElements,\n    \"wp:inline\": readDrawingElement,\n    \"wp:anchor\": readDrawingElement,\n    \"v:imagedata\": readImageData,\n    \"v:group\": readChildElements,\n    \"v:rect\": readChildElements\n  };\n  return {\n    readXmlElement: readXmlElement,\n    readXmlElements: readXmlElements\n  };\n  function readTable(element) {\n    var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n    return readXmlElements(element.children).flatMap(calculateRowSpans).flatMap(function (children) {\n      return propertiesResult.map(function (properties) {\n        return documents.Table(children, properties);\n      });\n    });\n  }\n  function readTableProperties(element) {\n    return readTableStyle(element).map(function (style) {\n      return {\n        styleId: style.styleId,\n        styleName: style.name\n      };\n    });\n  }\n  function readTableRow(element) {\n    var properties = element.firstOrEmpty(\"w:trPr\");\n    var isHeader = !!properties.first(\"w:tblHeader\");\n    return readXmlElements(element.children).map(function (children) {\n      return documents.TableRow(children, {\n        isHeader: isHeader\n      });\n    });\n  }\n  function readTableCell(element) {\n    return readXmlElements(element.children).map(function (children) {\n      var properties = element.firstOrEmpty(\"w:tcPr\");\n      var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n      var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n      var cell = documents.TableCell(children, {\n        colSpan: colSpan\n      });\n      cell._vMerge = readVMerge(properties);\n      return cell;\n    });\n  }\n  function readVMerge(properties) {\n    var element = properties.first(\"w:vMerge\");\n    if (element) {\n      var val = element.attributes[\"w:val\"];\n      return val === \"continue\" || !val;\n    } else {\n      return null;\n    }\n  }\n  function calculateRowSpans(rows) {\n    var unexpectedNonRows = _.any(rows, function (row) {\n      return row.type !== documents.types.tableRow;\n    });\n    if (unexpectedNonRows) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-row element in table, cell merging may be incorrect\")]);\n    }\n    var unexpectedNonCells = _.any(rows, function (row) {\n      return _.any(row.children, function (cell) {\n        return cell.type !== documents.types.tableCell;\n      });\n    });\n    if (unexpectedNonCells) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-cell element in table row, cell merging may be incorrect\")]);\n    }\n    var columns = {};\n    rows.forEach(function (row) {\n      var cellIndex = 0;\n      row.children.forEach(function (cell) {\n        if (cell._vMerge && columns[cellIndex]) {\n          columns[cellIndex].rowSpan++;\n        } else {\n          columns[cellIndex] = cell;\n          cell._vMerge = false;\n        }\n        cellIndex += cell.colSpan;\n      });\n    });\n    rows.forEach(function (row) {\n      row.children = row.children.filter(function (cell) {\n        return !cell._vMerge;\n      });\n      row.children.forEach(function (cell) {\n        delete cell._vMerge;\n      });\n    });\n    return elementResult(rows);\n  }\n  function readDrawingElement(element) {\n    var blips = element.getElementsByTagName(\"a:graphic\").getElementsByTagName(\"a:graphicData\").getElementsByTagName(\"pic:pic\").getElementsByTagName(\"pic:blipFill\").getElementsByTagName(\"a:blip\");\n    return combineResults(blips.map(readBlip.bind(null, element)));\n  }\n  function readBlip(element, blip) {\n    var properties = element.first(\"wp:docPr\").attributes;\n    var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n    var blipImageFile = findBlipImageFile(blip);\n    if (blipImageFile === null) {\n      return emptyResultWithMessages([warning(\"Could not find image file for a:blip element\")]);\n    } else {\n      return readImage(blipImageFile, altText);\n    }\n  }\n  function isBlank(value) {\n    return value == null || /^\\s*$/.test(value);\n  }\n  function findBlipImageFile(blip) {\n    var embedRelationshipId = blip.attributes[\"r:embed\"];\n    var linkRelationshipId = blip.attributes[\"r:link\"];\n    if (embedRelationshipId) {\n      return findEmbeddedImageFile(embedRelationshipId);\n    } else if (linkRelationshipId) {\n      var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n      return {\n        path: imagePath,\n        read: files.read.bind(files, imagePath)\n      };\n    } else {\n      return null;\n    }\n  }\n  function readImageData(element) {\n    var relationshipId = element.attributes['r:id'];\n    if (relationshipId) {\n      return readImage(findEmbeddedImageFile(relationshipId), element.attributes[\"o:title\"]);\n    } else {\n      return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n    }\n  }\n  function findEmbeddedImageFile(relationshipId) {\n    var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n    return {\n      path: path,\n      read: docxFile.read.bind(docxFile, path)\n    };\n  }\n  function readImage(imageFile, altText) {\n    var contentType = contentTypes.findContentType(imageFile.path);\n    var image = documents.Image({\n      readImage: imageFile.read,\n      altText: altText,\n      contentType: contentType\n    });\n    var warnings = supportedImageTypes[contentType] ? [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n    return elementResultWithMessages(image, warnings);\n  }\n  function undefinedStyleWarning(type, styleId) {\n    return warning(type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n  }\n}\nfunction readNumberingProperties(styleId, element, numbering) {\n  var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n  var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n  if (level !== undefined && numId !== undefined) {\n    return numbering.findLevel(numId, level);\n  }\n  if (styleId != null) {\n    var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n    if (levelByStyleId != null) {\n      return levelByStyleId;\n    }\n  }\n  return null;\n}\nvar supportedImageTypes = {\n  \"image/png\": true,\n  \"image/gif\": true,\n  \"image/jpeg\": true,\n  \"image/svg+xml\": true,\n  \"image/tiff\": true\n};\nvar ignoreElements = {\n  \"office-word:wrap\": true,\n  \"v:shadow\": true,\n  \"v:shapetype\": true,\n  \"w:annotationRef\": true,\n  \"w:bookmarkEnd\": true,\n  \"w:sectPr\": true,\n  \"w:proofErr\": true,\n  \"w:lastRenderedPageBreak\": true,\n  \"w:commentRangeStart\": true,\n  \"w:commentRangeEnd\": true,\n  \"w:del\": true,\n  \"w:footnoteRef\": true,\n  \"w:endnoteRef\": true,\n  \"w:pPr\": true,\n  \"w:rPr\": true,\n  \"w:tblPr\": true,\n  \"w:tblGrid\": true,\n  \"w:trPr\": true,\n  \"w:tcPr\": true\n};\nfunction emptyResultWithMessages(messages) {\n  return new ReadResult(null, null, messages);\n}\nfunction emptyResult() {\n  return new ReadResult(null);\n}\nfunction elementResult(element) {\n  return new ReadResult(element);\n}\nfunction elementResultWithMessages(element, messages) {\n  return new ReadResult(element, null, messages);\n}\nfunction ReadResult(element, extra, messages) {\n  this.value = element || [];\n  this.extra = extra || [];\n  this._result = new Result({\n    element: this.value,\n    extra: extra\n  }, messages);\n  this.messages = this._result.messages;\n}\nReadResult.prototype.toExtra = function () {\n  return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\nReadResult.prototype.insertExtra = function () {\n  var extra = this.extra;\n  if (extra && extra.length) {\n    return new ReadResult(joinElements(this.value, extra), null, this.messages);\n  } else {\n    return this;\n  }\n};\nReadResult.prototype.map = function (func) {\n  var result = this._result.map(function (value) {\n    return func(value.element);\n  });\n  return new ReadResult(result.value, this.extra, result.messages);\n};\nReadResult.prototype.flatMap = function (func) {\n  var result = this._result.flatMap(function (value) {\n    return func(value.element)._result;\n  });\n  return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\nReadResult.map = function (first, second, func) {\n  return new ReadResult(func(first.value, second.value), joinElements(first.extra, second.extra), first.messages.concat(second.messages));\n};\nfunction combineResults(results) {\n  var result = Result.combine(_.pluck(results, \"_result\"));\n  return new ReadResult(_.flatten(_.pluck(result.value, \"element\")), _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity), result.messages);\n}\nfunction joinElements(first, second) {\n  return _.flatten([first, second]);\n}\nfunction identity(value) {\n  return value;\n}","map":{"version":3,"names":["exports","createBodyReader","_readNumberingProperties","readNumberingProperties","dingbatToUnicode","require","_","documents","Result","warning","xml","uris","options","readXmlElement","element","BodyReader","readXmlElements","elements","complexFieldStack","currentInstrText","deletedParagraphContents","relationships","contentTypes","docxFile","files","numbering","styles","results","map","combineResults","type","handler","xmlElementReaders","name","Object","prototype","hasOwnProperty","call","ignoreElements","message","emptyResultWithMessages","emptyResult","readParagraphProperties","readParagraphStyle","style","styleId","styleName","alignment","firstOrEmpty","attributes","indent","readParagraphIndent","start","end","firstLine","hanging","readRunProperties","readRunStyle","fontSizeString","fontSize","test","parseInt","verticalAlignment","font","isBold","readBooleanElement","first","isUnderline","readUnderline","isItalic","isStrikethrough","isAllCaps","isSmallCaps","highlight","readHighlightValue","value","undefined","readBooleanAttributeValue","readStyle","findParagraphStyleById","findCharacterStyleById","readTableStyle","findTableStyleById","styleTagName","styleType","findStyleById","messages","styleElement","push","undefinedStyleWarning","elementResultWithMessages","readFldChar","fldChar","complexFieldEnd","pop","parseCurrentInstrText","elementResult","checkbox","checked","complexFieldSeparate","complexField","currentHyperlinkOptions","topHyperlink","last","filter","parseInstrText","join","emptyElement","instrText","externalLinkResult","exec","href","internalLinkResult","anchor","checkboxResult","checkboxElement","checkedElement","readInstrText","text","readSymbol","char","unicodeCharacter","hex","substring","Text","string","noteReferenceReader","noteType","noteId","NoteReference","readCommentReference","commentReference","commentId","readChildElements","children","w:p","paragraphPropertiesElement","isDeleted","forEach","child","childrenXml","length","concat","ReadResult","properties","Paragraph","insertExtra","w:r","hyperlinkOptions","Hyperlink","Run","w:t","w:tab","Tab","w:noBreakHyphen","w:softHyphen","w:hyperlink","relationshipId","create","targetFrame","extend","findTargetByRelationshipId","replaceFragment","readTable","readTableRow","readTableCell","w:br","breakType","lineBreak","pageBreak","columnBreak","w:bookmarkStart","BookmarkStart","mc:AlternateContent","w:sdt","isChecked","w:pict","toExtra","readDrawingElement","readImageData","propertiesResult","readTableProperties","flatMap","calculateRowSpans","Table","isHeader","TableRow","gridSpan","colSpan","cell","TableCell","_vMerge","readVMerge","val","rows","unexpectedNonRows","any","row","types","tableRow","unexpectedNonCells","tableCell","columns","cellIndex","rowSpan","blips","getElementsByTagName","readBlip","bind","blip","altText","isBlank","descr","title","blipImageFile","findBlipImageFile","readImage","embedRelationshipId","linkRelationshipId","findEmbeddedImageFile","imagePath","path","read","uriToZipEntryName","imageFile","contentType","findContentType","image","Image","warnings","supportedImageTypes","level","numId","findLevel","levelByStyleId","findLevelByParagraphStyleId","extra","_result","joinElements","func","result","second","combine","pluck","flatten","identity"],"sources":["D:/sumit/hfc/wrm/node_modules/mammoth/lib/docx/body-reader.js"],"sourcesContent":["exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\n\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\nvar _ = require(\"underscore\");\n\nvar documents = require(\"../documents\");\nvar Result = require(\"../results\").Result;\nvar warning = require(\"../results\").warning;\nvar xml = require(\"../xml\");\nvar uris = require(\"./uris\");\n\nfunction createBodyReader(options) {\n    return {\n        readXmlElement: function(element) {\n            return new BodyReader(options).readXmlElement(element);\n        },\n        readXmlElements: function(elements) {\n            return new BodyReader(options).readXmlElements(elements);\n        }\n    };\n}\n\nfunction BodyReader(options) {\n    var complexFieldStack = [];\n    var currentInstrText = [];\n\n    // When a paragraph is marked as deleted, its contents should be combined\n    // with the following paragraph. See 17.13.5.15 del (Deleted Paragraph) of\n    // ECMA-376 4th edition Part 1.\n    var deletedParagraphContents = [];\n\n    var relationships = options.relationships;\n    var contentTypes = options.contentTypes;\n    var docxFile = options.docxFile;\n    var files = options.files;\n    var numbering = options.numbering;\n    var styles = options.styles;\n\n    function readXmlElements(elements) {\n        var results = elements.map(readXmlElement);\n        return combineResults(results);\n    }\n\n    function readXmlElement(element) {\n        if (element.type === \"element\") {\n            var handler = xmlElementReaders[element.name];\n            if (handler) {\n                return handler(element);\n            } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n                var message = warning(\"An unrecognised element was ignored: \" + element.name);\n                return emptyResultWithMessages([message]);\n            }\n        }\n        return emptyResult();\n    }\n\n    function readParagraphProperties(element) {\n        return readParagraphStyle(element).map(function(style) {\n            return {\n                type: \"paragraphProperties\",\n                styleId: style.styleId,\n                styleName: style.name,\n                alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n                numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n                indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n            };\n        });\n    }\n\n    function readParagraphIndent(element) {\n        return {\n            start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n            end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n            firstLine: element.attributes[\"w:firstLine\"],\n            hanging: element.attributes[\"w:hanging\"]\n        };\n    }\n\n    function readRunProperties(element) {\n        return readRunStyle(element).map(function(style) {\n            var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"];\n            // w:sz gives the font size in half points, so halve the value to get the size in points\n            var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n\n            return {\n                type: \"runProperties\",\n                styleId: style.styleId,\n                styleName: style.name,\n                verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n                font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n                fontSize: fontSize,\n                isBold: readBooleanElement(element.first(\"w:b\")),\n                isUnderline: readUnderline(element.first(\"w:u\")),\n                isItalic: readBooleanElement(element.first(\"w:i\")),\n                isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n                isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n                isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\")),\n                highlight: readHighlightValue(element.firstOrEmpty(\"w:highlight\").attributes[\"w:val\"])\n            };\n        });\n    }\n\n    function readUnderline(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== undefined && value !== \"false\" && value !== \"0\" && value !== \"none\";\n        } else {\n            return false;\n        }\n    }\n\n    function readBooleanElement(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== \"false\" && value !== \"0\";\n        } else {\n            return false;\n        }\n    }\n\n    function readBooleanAttributeValue(value) {\n        return value !== \"false\" && value !== \"0\";\n    }\n\n    function readHighlightValue(value) {\n        if (!value || value === \"none\") {\n            return null;\n        } else {\n            return value;\n        }\n    }\n\n    function readParagraphStyle(element) {\n        return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n    }\n\n    function readRunStyle(element) {\n        return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n    }\n\n    function readTableStyle(element) {\n        return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n    }\n\n    function readStyle(element, styleTagName, styleType, findStyleById) {\n        var messages = [];\n        var styleElement = element.first(styleTagName);\n        var styleId = null;\n        var name = null;\n        if (styleElement) {\n            styleId = styleElement.attributes[\"w:val\"];\n            if (styleId) {\n                var style = findStyleById(styleId);\n                if (style) {\n                    name = style.name;\n                } else {\n                    messages.push(undefinedStyleWarning(styleType, styleId));\n                }\n            }\n        }\n        return elementResultWithMessages({styleId: styleId, name: name}, messages);\n    }\n\n    function readFldChar(element) {\n        var type = element.attributes[\"w:fldCharType\"];\n        if (type === \"begin\") {\n            complexFieldStack.push({type: \"begin\", fldChar: element});\n            currentInstrText = [];\n        } else if (type === \"end\") {\n            var complexFieldEnd = complexFieldStack.pop();\n            if (complexFieldEnd.type === \"begin\") {\n                complexFieldEnd = parseCurrentInstrText(complexFieldEnd);\n            }\n            if (complexFieldEnd.type === \"checkbox\") {\n                return elementResult(documents.checkbox({\n                    checked: complexFieldEnd.checked\n                }));\n            }\n        } else if (type === \"separate\") {\n            var complexFieldSeparate = complexFieldStack.pop();\n            var complexField = parseCurrentInstrText(complexFieldSeparate);\n            complexFieldStack.push(complexField);\n        }\n        return emptyResult();\n    }\n\n    function currentHyperlinkOptions() {\n        var topHyperlink = _.last(complexFieldStack.filter(function(complexField) {\n            return complexField.type === \"hyperlink\";\n        }));\n        return topHyperlink ? topHyperlink.options : null;\n    }\n\n    function parseCurrentInstrText(complexField) {\n        return parseInstrText(\n            currentInstrText.join(''),\n            complexField.type === \"begin\"\n                ? complexField.fldChar\n                : xml.emptyElement\n        );\n    }\n\n    function parseInstrText(instrText, fldChar) {\n        var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(instrText);\n        if (externalLinkResult) {\n            return {type: \"hyperlink\", options: {href: externalLinkResult[1]}};\n        }\n\n        var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(instrText);\n        if (internalLinkResult) {\n            return {type: \"hyperlink\", options: {anchor: internalLinkResult[1]}};\n        }\n\n        var checkboxResult = /\\s*FORMCHECKBOX\\s*/.exec(instrText);\n        if (checkboxResult) {\n            var checkboxElement = fldChar\n                .firstOrEmpty(\"w:ffData\")\n                .firstOrEmpty(\"w:checkBox\");\n            var checkedElement = checkboxElement.first(\"w:checked\");\n            var checked = checkedElement == null\n                ? readBooleanElement(checkboxElement.first(\"w:default\"))\n                : readBooleanElement(checkedElement);\n            return {type: \"checkbox\", checked: checked};\n        }\n\n        return {type: \"unknown\"};\n    }\n\n    function readInstrText(element) {\n        currentInstrText.push(element.text());\n        return emptyResult();\n    }\n\n    function readSymbol(element) {\n        // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n        var font = element.attributes[\"w:font\"];\n        var char = element.attributes[\"w:char\"];\n        var unicodeCharacter = dingbatToUnicode.hex(font, char);\n        if (unicodeCharacter == null && /^F0..$/.test(char)) {\n            unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n        }\n\n        if (unicodeCharacter == null) {\n            return emptyResultWithMessages([warning(\n                \"A w:sym element with an unsupported character was ignored: char \" +  char + \" in font \" + font\n            )]);\n        } else {\n            return elementResult(new documents.Text(unicodeCharacter.string));\n        }\n    }\n\n    function noteReferenceReader(noteType) {\n        return function(element) {\n            var noteId = element.attributes[\"w:id\"];\n            return elementResult(new documents.NoteReference({\n                noteType: noteType,\n                noteId: noteId\n            }));\n        };\n    }\n\n    function readCommentReference(element) {\n        return elementResult(documents.commentReference({\n            commentId: element.attributes[\"w:id\"]\n        }));\n    }\n\n    function readChildElements(element) {\n        return readXmlElements(element.children);\n    }\n\n    var xmlElementReaders = {\n        \"w:p\": function(element) {\n            var paragraphPropertiesElement = element.firstOrEmpty(\"w:pPr\");\n\n            var isDeleted = !!paragraphPropertiesElement\n                .firstOrEmpty(\"w:rPr\")\n                .first(\"w:del\");\n\n            if (isDeleted) {\n                element.children.forEach(function(child) {\n                    deletedParagraphContents.push(child);\n                });\n                return emptyResult();\n            } else {\n                var childrenXml = element.children;\n                if (deletedParagraphContents.length > 0) {\n                    childrenXml = deletedParagraphContents.concat(childrenXml);\n                    deletedParagraphContents = [];\n                }\n                return ReadResult.map(\n                    readParagraphProperties(paragraphPropertiesElement),\n                    readXmlElements(childrenXml),\n                    function(properties, children) {\n                        return new documents.Paragraph(children, properties);\n                    }\n                ).insertExtra();\n            }\n        },\n        \"w:r\": function(element) {\n            return ReadResult.map(\n                readRunProperties(element.firstOrEmpty(\"w:rPr\")),\n                readXmlElements(element.children),\n                function(properties, children) {\n                    var hyperlinkOptions = currentHyperlinkOptions();\n                    if (hyperlinkOptions !== null) {\n                        children = [new documents.Hyperlink(children, hyperlinkOptions)];\n                    }\n\n                    return new documents.Run(children, properties);\n                }\n            );\n        },\n        \"w:fldChar\": readFldChar,\n        \"w:instrText\": readInstrText,\n        \"w:t\": function(element) {\n            return elementResult(new documents.Text(element.text()));\n        },\n        \"w:tab\": function(element) {\n            return elementResult(new documents.Tab());\n        },\n        \"w:noBreakHyphen\": function() {\n            return elementResult(new documents.Text(\"\\u2011\"));\n        },\n        \"w:softHyphen\": function(element) {\n            return elementResult(new documents.Text(\"\\u00AD\"));\n        },\n        \"w:sym\": readSymbol,\n        \"w:hyperlink\": function(element) {\n            var relationshipId = element.attributes[\"r:id\"];\n            var anchor = element.attributes[\"w:anchor\"];\n            return readXmlElements(element.children).map(function(children) {\n                function create(options) {\n                    var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n\n                    return new documents.Hyperlink(\n                        children,\n                        _.extend({targetFrame: targetFrame}, options)\n                    );\n                }\n\n                if (relationshipId) {\n                    var href = relationships.findTargetByRelationshipId(relationshipId);\n                    if (anchor) {\n                        href = uris.replaceFragment(href, anchor);\n                    }\n                    return create({href: href});\n                } else if (anchor) {\n                    return create({anchor: anchor});\n                } else {\n                    return children;\n                }\n            });\n        },\n        \"w:tbl\": readTable,\n        \"w:tr\": readTableRow,\n        \"w:tc\": readTableCell,\n        \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n        \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n        \"w:commentReference\": readCommentReference,\n        \"w:br\": function(element) {\n            var breakType = element.attributes[\"w:type\"];\n            if (breakType == null || breakType === \"textWrapping\") {\n                return elementResult(documents.lineBreak);\n            } else if (breakType === \"page\") {\n                return elementResult(documents.pageBreak);\n            } else if (breakType === \"column\") {\n                return elementResult(documents.columnBreak);\n            } else {\n                return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n            }\n        },\n        \"w:bookmarkStart\": function(element){\n            var name = element.attributes[\"w:name\"];\n            if (name === \"_GoBack\") {\n                return emptyResult();\n            } else {\n                return elementResult(new documents.BookmarkStart({name: name}));\n            }\n        },\n\n        \"mc:AlternateContent\": function(element) {\n            return readChildElements(element.first(\"mc:Fallback\"));\n        },\n\n        \"w:sdt\": function(element) {\n            var checkbox = element\n                .firstOrEmpty(\"w:sdtPr\")\n                .first(\"wordml:checkbox\");\n\n            if (checkbox) {\n                var checkedElement = checkbox.first(\"wordml:checked\");\n                var isChecked = !!checkedElement && readBooleanAttributeValue(\n                    checkedElement.attributes[\"wordml:val\"]\n                );\n                return elementResult(documents.checkbox({\n                    checked: isChecked\n                }));\n            } else {\n                return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n            }\n        },\n\n        \"w:ins\": readChildElements,\n        \"w:object\": readChildElements,\n        \"w:smartTag\": readChildElements,\n        \"w:drawing\": readChildElements,\n        \"w:pict\": function(element) {\n            return readChildElements(element).toExtra();\n        },\n        \"v:roundrect\": readChildElements,\n        \"v:shape\": readChildElements,\n        \"v:textbox\": readChildElements,\n        \"w:txbxContent\": readChildElements,\n        \"wp:inline\": readDrawingElement,\n        \"wp:anchor\": readDrawingElement,\n        \"v:imagedata\": readImageData,\n        \"v:group\": readChildElements,\n        \"v:rect\": readChildElements\n    };\n\n    return {\n        readXmlElement: readXmlElement,\n        readXmlElements: readXmlElements\n    };\n\n\n    function readTable(element) {\n        var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n        return readXmlElements(element.children)\n            .flatMap(calculateRowSpans)\n            .flatMap(function(children) {\n                return propertiesResult.map(function(properties) {\n                    return documents.Table(children, properties);\n                });\n            });\n    }\n\n    function readTableProperties(element) {\n        return readTableStyle(element).map(function(style) {\n            return {\n                styleId: style.styleId,\n                styleName: style.name\n            };\n        });\n    }\n\n    function readTableRow(element) {\n        var properties = element.firstOrEmpty(\"w:trPr\");\n        var isHeader = !!properties.first(\"w:tblHeader\");\n        return readXmlElements(element.children).map(function(children) {\n            return documents.TableRow(children, {isHeader: isHeader});\n        });\n    }\n\n    function readTableCell(element) {\n        return readXmlElements(element.children).map(function(children) {\n            var properties = element.firstOrEmpty(\"w:tcPr\");\n\n            var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n            var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n\n            var cell = documents.TableCell(children, {colSpan: colSpan});\n            cell._vMerge = readVMerge(properties);\n            return cell;\n        });\n    }\n\n    function readVMerge(properties) {\n        var element = properties.first(\"w:vMerge\");\n        if (element) {\n            var val = element.attributes[\"w:val\"];\n            return val === \"continue\" || !val;\n        } else {\n            return null;\n        }\n    }\n\n    function calculateRowSpans(rows) {\n        var unexpectedNonRows = _.any(rows, function(row) {\n            return row.type !== documents.types.tableRow;\n        });\n        if (unexpectedNonRows) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-row element in table, cell merging may be incorrect\"\n            )]);\n        }\n        var unexpectedNonCells = _.any(rows, function(row) {\n            return _.any(row.children, function(cell) {\n                return cell.type !== documents.types.tableCell;\n            });\n        });\n        if (unexpectedNonCells) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-cell element in table row, cell merging may be incorrect\"\n            )]);\n        }\n\n        var columns = {};\n\n        rows.forEach(function(row) {\n            var cellIndex = 0;\n            row.children.forEach(function(cell) {\n                if (cell._vMerge && columns[cellIndex]) {\n                    columns[cellIndex].rowSpan++;\n                } else {\n                    columns[cellIndex] = cell;\n                    cell._vMerge = false;\n                }\n                cellIndex += cell.colSpan;\n            });\n        });\n\n        rows.forEach(function(row) {\n            row.children = row.children.filter(function(cell) {\n                return !cell._vMerge;\n            });\n            row.children.forEach(function(cell) {\n                delete cell._vMerge;\n            });\n        });\n\n        return elementResult(rows);\n    }\n\n    function readDrawingElement(element) {\n        var blips = element\n            .getElementsByTagName(\"a:graphic\")\n            .getElementsByTagName(\"a:graphicData\")\n            .getElementsByTagName(\"pic:pic\")\n            .getElementsByTagName(\"pic:blipFill\")\n            .getElementsByTagName(\"a:blip\");\n\n        return combineResults(blips.map(readBlip.bind(null, element)));\n    }\n\n    function readBlip(element, blip) {\n        var properties = element.first(\"wp:docPr\").attributes;\n        var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n        var blipImageFile = findBlipImageFile(blip);\n        if (blipImageFile === null) {\n            return emptyResultWithMessages([warning(\"Could not find image file for a:blip element\")]);\n        } else {\n            return readImage(blipImageFile, altText);\n        }\n    }\n\n    function isBlank(value) {\n        return value == null || /^\\s*$/.test(value);\n    }\n\n    function findBlipImageFile(blip) {\n        var embedRelationshipId = blip.attributes[\"r:embed\"];\n        var linkRelationshipId = blip.attributes[\"r:link\"];\n        if (embedRelationshipId) {\n            return findEmbeddedImageFile(embedRelationshipId);\n        } else if (linkRelationshipId) {\n            var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n            return {\n                path: imagePath,\n                read: files.read.bind(files, imagePath)\n            };\n        } else {\n            return null;\n        }\n    }\n\n    function readImageData(element) {\n        var relationshipId = element.attributes['r:id'];\n\n        if (relationshipId) {\n            return readImage(\n                findEmbeddedImageFile(relationshipId),\n                element.attributes[\"o:title\"]);\n        } else {\n            return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n        }\n    }\n\n    function findEmbeddedImageFile(relationshipId) {\n        var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n        return {\n            path: path,\n            read: docxFile.read.bind(docxFile, path)\n        };\n    }\n\n    function readImage(imageFile, altText) {\n        var contentType = contentTypes.findContentType(imageFile.path);\n\n        var image = documents.Image({\n            readImage: imageFile.read,\n            altText: altText,\n            contentType: contentType\n        });\n        var warnings = supportedImageTypes[contentType] ?\n            [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n        return elementResultWithMessages(image, warnings);\n    }\n\n    function undefinedStyleWarning(type, styleId) {\n        return warning(\n            type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n    }\n}\n\n\nfunction readNumberingProperties(styleId, element, numbering) {\n    var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n    var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n    if (level !== undefined && numId !== undefined) {\n        return numbering.findLevel(numId, level);\n    }\n\n    if (styleId != null) {\n        var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n        if (levelByStyleId != null) {\n            return levelByStyleId;\n        }\n    }\n\n    return null;\n}\n\nvar supportedImageTypes = {\n    \"image/png\": true,\n    \"image/gif\": true,\n    \"image/jpeg\": true,\n    \"image/svg+xml\": true,\n    \"image/tiff\": true\n};\n\nvar ignoreElements = {\n    \"office-word:wrap\": true,\n    \"v:shadow\": true,\n    \"v:shapetype\": true,\n    \"w:annotationRef\": true,\n    \"w:bookmarkEnd\": true,\n    \"w:sectPr\": true,\n    \"w:proofErr\": true,\n    \"w:lastRenderedPageBreak\": true,\n    \"w:commentRangeStart\": true,\n    \"w:commentRangeEnd\": true,\n    \"w:del\": true,\n    \"w:footnoteRef\": true,\n    \"w:endnoteRef\": true,\n    \"w:pPr\": true,\n    \"w:rPr\": true,\n    \"w:tblPr\": true,\n    \"w:tblGrid\": true,\n    \"w:trPr\": true,\n    \"w:tcPr\": true\n};\n\nfunction emptyResultWithMessages(messages) {\n    return new ReadResult(null, null, messages);\n}\n\nfunction emptyResult() {\n    return new ReadResult(null);\n}\n\nfunction elementResult(element) {\n    return new ReadResult(element);\n}\n\nfunction elementResultWithMessages(element, messages) {\n    return new ReadResult(element, null, messages);\n}\n\nfunction ReadResult(element, extra, messages) {\n    this.value = element || [];\n    this.extra = extra || [];\n    this._result = new Result({\n        element: this.value,\n        extra: extra\n    }, messages);\n    this.messages = this._result.messages;\n}\n\nReadResult.prototype.toExtra = function() {\n    return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\n\nReadResult.prototype.insertExtra = function() {\n    var extra = this.extra;\n    if (extra && extra.length) {\n        return new ReadResult(joinElements(this.value, extra), null, this.messages);\n    } else {\n        return this;\n    }\n};\n\nReadResult.prototype.map = function(func) {\n    var result = this._result.map(function(value) {\n        return func(value.element);\n    });\n    return new ReadResult(result.value, this.extra, result.messages);\n};\n\nReadResult.prototype.flatMap = function(func) {\n    var result = this._result.flatMap(function(value) {\n        return func(value.element)._result;\n    });\n    return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\n\nReadResult.map = function(first, second, func) {\n    return new ReadResult(\n        func(first.value, second.value),\n        joinElements(first.extra, second.extra),\n        first.messages.concat(second.messages)\n    );\n};\n\nfunction combineResults(results) {\n    var result = Result.combine(_.pluck(results, \"_result\"));\n    return new ReadResult(\n        _.flatten(_.pluck(result.value, \"element\")),\n        _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity),\n        result.messages\n    );\n}\n\nfunction joinElements(first, second) {\n    return _.flatten([first, second]);\n}\n\nfunction identity(value) {\n    return value;\n}\n"],"mappings":"AAAAA,OAAO,CAACC,gBAAgB,GAAGA,gBAAgB;AAC3CD,OAAO,CAACE,wBAAwB,GAAGC,uBAAuB;AAE1D,IAAIC,gBAAgB,GAAGC,OAAO,CAAC,oBAAoB,CAAC;AACpD,IAAIC,CAAC,GAAGD,OAAO,CAAC,YAAY,CAAC;AAE7B,IAAIE,SAAS,GAAGF,OAAO,CAAC,cAAc,CAAC;AACvC,IAAIG,MAAM,GAAGH,OAAO,CAAC,YAAY,CAAC,CAACG,MAAM;AACzC,IAAIC,OAAO,GAAGJ,OAAO,CAAC,YAAY,CAAC,CAACI,OAAO;AAC3C,IAAIC,GAAG,GAAGL,OAAO,CAAC,QAAQ,CAAC;AAC3B,IAAIM,IAAI,GAAGN,OAAO,CAAC,QAAQ,CAAC;AAE5B,SAASJ,gBAAgBA,CAACW,OAAO,EAAE;EAC/B,OAAO;IACHC,cAAc,EAAE,SAAAA,CAASC,OAAO,EAAE;MAC9B,OAAO,IAAIC,UAAU,CAACH,OAAO,CAAC,CAACC,cAAc,CAACC,OAAO,CAAC;IAC1D,CAAC;IACDE,eAAe,EAAE,SAAAA,CAASC,QAAQ,EAAE;MAChC,OAAO,IAAIF,UAAU,CAACH,OAAO,CAAC,CAACI,eAAe,CAACC,QAAQ,CAAC;IAC5D;EACJ,CAAC;AACL;AAEA,SAASF,UAAUA,CAACH,OAAO,EAAE;EACzB,IAAIM,iBAAiB,GAAG,EAAE;EAC1B,IAAIC,gBAAgB,GAAG,EAAE;;EAEzB;EACA;EACA;EACA,IAAIC,wBAAwB,GAAG,EAAE;EAEjC,IAAIC,aAAa,GAAGT,OAAO,CAACS,aAAa;EACzC,IAAIC,YAAY,GAAGV,OAAO,CAACU,YAAY;EACvC,IAAIC,QAAQ,GAAGX,OAAO,CAACW,QAAQ;EAC/B,IAAIC,KAAK,GAAGZ,OAAO,CAACY,KAAK;EACzB,IAAIC,SAAS,GAAGb,OAAO,CAACa,SAAS;EACjC,IAAIC,MAAM,GAAGd,OAAO,CAACc,MAAM;EAE3B,SAASV,eAAeA,CAACC,QAAQ,EAAE;IAC/B,IAAIU,OAAO,GAAGV,QAAQ,CAACW,GAAG,CAACf,cAAc,CAAC;IAC1C,OAAOgB,cAAc,CAACF,OAAO,CAAC;EAClC;EAEA,SAASd,cAAcA,CAACC,OAAO,EAAE;IAC7B,IAAIA,OAAO,CAACgB,IAAI,KAAK,SAAS,EAAE;MAC5B,IAAIC,OAAO,GAAGC,iBAAiB,CAAClB,OAAO,CAACmB,IAAI,CAAC;MAC7C,IAAIF,OAAO,EAAE;QACT,OAAOA,OAAO,CAACjB,OAAO,CAAC;MAC3B,CAAC,MAAM,IAAI,CAACoB,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACC,cAAc,EAAExB,OAAO,CAACmB,IAAI,CAAC,EAAE;QAC5E,IAAIM,OAAO,GAAG9B,OAAO,CAAC,uCAAuC,GAAGK,OAAO,CAACmB,IAAI,CAAC;QAC7E,OAAOO,uBAAuB,CAAC,CAACD,OAAO,CAAC,CAAC;MAC7C;IACJ;IACA,OAAOE,WAAW,CAAC,CAAC;EACxB;EAEA,SAASC,uBAAuBA,CAAC5B,OAAO,EAAE;IACtC,OAAO6B,kBAAkB,CAAC7B,OAAO,CAAC,CAACc,GAAG,CAAC,UAASgB,KAAK,EAAE;MACnD,OAAO;QACHd,IAAI,EAAE,qBAAqB;QAC3Be,OAAO,EAAED,KAAK,CAACC,OAAO;QACtBC,SAAS,EAAEF,KAAK,CAACX,IAAI;QACrBc,SAAS,EAAEjC,OAAO,CAACkC,YAAY,CAAC,MAAM,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;QAC3DxB,SAAS,EAAEtB,uBAAuB,CAACyC,KAAK,CAACC,OAAO,EAAE/B,OAAO,CAACkC,YAAY,CAAC,SAAS,CAAC,EAAEvB,SAAS,CAAC;QAC7FyB,MAAM,EAAEC,mBAAmB,CAACrC,OAAO,CAACkC,YAAY,CAAC,OAAO,CAAC;MAC7D,CAAC;IACL,CAAC,CAAC;EACN;EAEA,SAASG,mBAAmBA,CAACrC,OAAO,EAAE;IAClC,OAAO;MACHsC,KAAK,EAAEtC,OAAO,CAACmC,UAAU,CAAC,SAAS,CAAC,IAAInC,OAAO,CAACmC,UAAU,CAAC,QAAQ,CAAC;MACpEI,GAAG,EAAEvC,OAAO,CAACmC,UAAU,CAAC,OAAO,CAAC,IAAInC,OAAO,CAACmC,UAAU,CAAC,SAAS,CAAC;MACjEK,SAAS,EAAExC,OAAO,CAACmC,UAAU,CAAC,aAAa,CAAC;MAC5CM,OAAO,EAAEzC,OAAO,CAACmC,UAAU,CAAC,WAAW;IAC3C,CAAC;EACL;EAEA,SAASO,iBAAiBA,CAAC1C,OAAO,EAAE;IAChC,OAAO2C,YAAY,CAAC3C,OAAO,CAAC,CAACc,GAAG,CAAC,UAASgB,KAAK,EAAE;MAC7C,IAAIc,cAAc,GAAG5C,OAAO,CAACkC,YAAY,CAAC,MAAM,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;MACrE;MACA,IAAIU,QAAQ,GAAG,UAAU,CAACC,IAAI,CAACF,cAAc,CAAC,GAAGG,QAAQ,CAACH,cAAc,EAAE,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI;MAExF,OAAO;QACH5B,IAAI,EAAE,eAAe;QACrBe,OAAO,EAAED,KAAK,CAACC,OAAO;QACtBC,SAAS,EAAEF,KAAK,CAACX,IAAI;QACrB6B,iBAAiB,EAAEhD,OAAO,CAACkC,YAAY,CAAC,aAAa,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;QAC1Ec,IAAI,EAAEjD,OAAO,CAACkC,YAAY,CAAC,UAAU,CAAC,CAACC,UAAU,CAAC,SAAS,CAAC;QAC5DU,QAAQ,EAAEA,QAAQ;QAClBK,MAAM,EAAEC,kBAAkB,CAACnD,OAAO,CAACoD,KAAK,CAAC,KAAK,CAAC,CAAC;QAChDC,WAAW,EAAEC,aAAa,CAACtD,OAAO,CAACoD,KAAK,CAAC,KAAK,CAAC,CAAC;QAChDG,QAAQ,EAAEJ,kBAAkB,CAACnD,OAAO,CAACoD,KAAK,CAAC,KAAK,CAAC,CAAC;QAClDI,eAAe,EAAEL,kBAAkB,CAACnD,OAAO,CAACoD,KAAK,CAAC,UAAU,CAAC,CAAC;QAC9DK,SAAS,EAAEN,kBAAkB,CAACnD,OAAO,CAACoD,KAAK,CAAC,QAAQ,CAAC,CAAC;QACtDM,WAAW,EAAEP,kBAAkB,CAACnD,OAAO,CAACoD,KAAK,CAAC,aAAa,CAAC,CAAC;QAC7DO,SAAS,EAAEC,kBAAkB,CAAC5D,OAAO,CAACkC,YAAY,CAAC,aAAa,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;MACzF,CAAC;IACL,CAAC,CAAC;EACN;EAEA,SAASmB,aAAaA,CAACtD,OAAO,EAAE;IAC5B,IAAIA,OAAO,EAAE;MACT,IAAI6D,KAAK,GAAG7D,OAAO,CAACmC,UAAU,CAAC,OAAO,CAAC;MACvC,OAAO0B,KAAK,KAAKC,SAAS,IAAID,KAAK,KAAK,OAAO,IAAIA,KAAK,KAAK,GAAG,IAAIA,KAAK,KAAK,MAAM;IACxF,CAAC,MAAM;MACH,OAAO,KAAK;IAChB;EACJ;EAEA,SAASV,kBAAkBA,CAACnD,OAAO,EAAE;IACjC,IAAIA,OAAO,EAAE;MACT,IAAI6D,KAAK,GAAG7D,OAAO,CAACmC,UAAU,CAAC,OAAO,CAAC;MACvC,OAAO0B,KAAK,KAAK,OAAO,IAAIA,KAAK,KAAK,GAAG;IAC7C,CAAC,MAAM;MACH,OAAO,KAAK;IAChB;EACJ;EAEA,SAASE,yBAAyBA,CAACF,KAAK,EAAE;IACtC,OAAOA,KAAK,KAAK,OAAO,IAAIA,KAAK,KAAK,GAAG;EAC7C;EAEA,SAASD,kBAAkBA,CAACC,KAAK,EAAE;IAC/B,IAAI,CAACA,KAAK,IAAIA,KAAK,KAAK,MAAM,EAAE;MAC5B,OAAO,IAAI;IACf,CAAC,MAAM;MACH,OAAOA,KAAK;IAChB;EACJ;EAEA,SAAShC,kBAAkBA,CAAC7B,OAAO,EAAE;IACjC,OAAOgE,SAAS,CAAChE,OAAO,EAAE,UAAU,EAAE,WAAW,EAAEY,MAAM,CAACqD,sBAAsB,CAAC;EACrF;EAEA,SAAStB,YAAYA,CAAC3C,OAAO,EAAE;IAC3B,OAAOgE,SAAS,CAAChE,OAAO,EAAE,UAAU,EAAE,KAAK,EAAEY,MAAM,CAACsD,sBAAsB,CAAC;EAC/E;EAEA,SAASC,cAAcA,CAACnE,OAAO,EAAE;IAC7B,OAAOgE,SAAS,CAAChE,OAAO,EAAE,YAAY,EAAE,OAAO,EAAEY,MAAM,CAACwD,kBAAkB,CAAC;EAC/E;EAEA,SAASJ,SAASA,CAAChE,OAAO,EAAEqE,YAAY,EAAEC,SAAS,EAAEC,aAAa,EAAE;IAChE,IAAIC,QAAQ,GAAG,EAAE;IACjB,IAAIC,YAAY,GAAGzE,OAAO,CAACoD,KAAK,CAACiB,YAAY,CAAC;IAC9C,IAAItC,OAAO,GAAG,IAAI;IAClB,IAAIZ,IAAI,GAAG,IAAI;IACf,IAAIsD,YAAY,EAAE;MACd1C,OAAO,GAAG0C,YAAY,CAACtC,UAAU,CAAC,OAAO,CAAC;MAC1C,IAAIJ,OAAO,EAAE;QACT,IAAID,KAAK,GAAGyC,aAAa,CAACxC,OAAO,CAAC;QAClC,IAAID,KAAK,EAAE;UACPX,IAAI,GAAGW,KAAK,CAACX,IAAI;QACrB,CAAC,MAAM;UACHqD,QAAQ,CAACE,IAAI,CAACC,qBAAqB,CAACL,SAAS,EAAEvC,OAAO,CAAC,CAAC;QAC5D;MACJ;IACJ;IACA,OAAO6C,yBAAyB,CAAC;MAAC7C,OAAO,EAAEA,OAAO;MAAEZ,IAAI,EAAEA;IAAI,CAAC,EAAEqD,QAAQ,CAAC;EAC9E;EAEA,SAASK,WAAWA,CAAC7E,OAAO,EAAE;IAC1B,IAAIgB,IAAI,GAAGhB,OAAO,CAACmC,UAAU,CAAC,eAAe,CAAC;IAC9C,IAAInB,IAAI,KAAK,OAAO,EAAE;MAClBZ,iBAAiB,CAACsE,IAAI,CAAC;QAAC1D,IAAI,EAAE,OAAO;QAAE8D,OAAO,EAAE9E;MAAO,CAAC,CAAC;MACzDK,gBAAgB,GAAG,EAAE;IACzB,CAAC,MAAM,IAAIW,IAAI,KAAK,KAAK,EAAE;MACvB,IAAI+D,eAAe,GAAG3E,iBAAiB,CAAC4E,GAAG,CAAC,CAAC;MAC7C,IAAID,eAAe,CAAC/D,IAAI,KAAK,OAAO,EAAE;QAClC+D,eAAe,GAAGE,qBAAqB,CAACF,eAAe,CAAC;MAC5D;MACA,IAAIA,eAAe,CAAC/D,IAAI,KAAK,UAAU,EAAE;QACrC,OAAOkE,aAAa,CAACzF,SAAS,CAAC0F,QAAQ,CAAC;UACpCC,OAAO,EAAEL,eAAe,CAACK;QAC7B,CAAC,CAAC,CAAC;MACP;IACJ,CAAC,MAAM,IAAIpE,IAAI,KAAK,UAAU,EAAE;MAC5B,IAAIqE,oBAAoB,GAAGjF,iBAAiB,CAAC4E,GAAG,CAAC,CAAC;MAClD,IAAIM,YAAY,GAAGL,qBAAqB,CAACI,oBAAoB,CAAC;MAC9DjF,iBAAiB,CAACsE,IAAI,CAACY,YAAY,CAAC;IACxC;IACA,OAAO3D,WAAW,CAAC,CAAC;EACxB;EAEA,SAAS4D,uBAAuBA,CAAA,EAAG;IAC/B,IAAIC,YAAY,GAAGhG,CAAC,CAACiG,IAAI,CAACrF,iBAAiB,CAACsF,MAAM,CAAC,UAASJ,YAAY,EAAE;MACtE,OAAOA,YAAY,CAACtE,IAAI,KAAK,WAAW;IAC5C,CAAC,CAAC,CAAC;IACH,OAAOwE,YAAY,GAAGA,YAAY,CAAC1F,OAAO,GAAG,IAAI;EACrD;EAEA,SAASmF,qBAAqBA,CAACK,YAAY,EAAE;IACzC,OAAOK,cAAc,CACjBtF,gBAAgB,CAACuF,IAAI,CAAC,EAAE,CAAC,EACzBN,YAAY,CAACtE,IAAI,KAAK,OAAO,GACvBsE,YAAY,CAACR,OAAO,GACpBlF,GAAG,CAACiG,YACd,CAAC;EACL;EAEA,SAASF,cAAcA,CAACG,SAAS,EAAEhB,OAAO,EAAE;IACxC,IAAIiB,kBAAkB,GAAG,qBAAqB,CAACC,IAAI,CAACF,SAAS,CAAC;IAC9D,IAAIC,kBAAkB,EAAE;MACpB,OAAO;QAAC/E,IAAI,EAAE,WAAW;QAAElB,OAAO,EAAE;UAACmG,IAAI,EAAEF,kBAAkB,CAAC,CAAC;QAAC;MAAC,CAAC;IACtE;IAEA,IAAIG,kBAAkB,GAAG,6BAA6B,CAACF,IAAI,CAACF,SAAS,CAAC;IACtE,IAAII,kBAAkB,EAAE;MACpB,OAAO;QAAClF,IAAI,EAAE,WAAW;QAAElB,OAAO,EAAE;UAACqG,MAAM,EAAED,kBAAkB,CAAC,CAAC;QAAC;MAAC,CAAC;IACxE;IAEA,IAAIE,cAAc,GAAG,oBAAoB,CAACJ,IAAI,CAACF,SAAS,CAAC;IACzD,IAAIM,cAAc,EAAE;MAChB,IAAIC,eAAe,GAAGvB,OAAO,CACxB5C,YAAY,CAAC,UAAU,CAAC,CACxBA,YAAY,CAAC,YAAY,CAAC;MAC/B,IAAIoE,cAAc,GAAGD,eAAe,CAACjD,KAAK,CAAC,WAAW,CAAC;MACvD,IAAIgC,OAAO,GAAGkB,cAAc,IAAI,IAAI,GAC9BnD,kBAAkB,CAACkD,eAAe,CAACjD,KAAK,CAAC,WAAW,CAAC,CAAC,GACtDD,kBAAkB,CAACmD,cAAc,CAAC;MACxC,OAAO;QAACtF,IAAI,EAAE,UAAU;QAAEoE,OAAO,EAAEA;MAAO,CAAC;IAC/C;IAEA,OAAO;MAACpE,IAAI,EAAE;IAAS,CAAC;EAC5B;EAEA,SAASuF,aAAaA,CAACvG,OAAO,EAAE;IAC5BK,gBAAgB,CAACqE,IAAI,CAAC1E,OAAO,CAACwG,IAAI,CAAC,CAAC,CAAC;IACrC,OAAO7E,WAAW,CAAC,CAAC;EACxB;EAEA,SAAS8E,UAAUA,CAACzG,OAAO,EAAE;IACzB;IACA,IAAIiD,IAAI,GAAGjD,OAAO,CAACmC,UAAU,CAAC,QAAQ,CAAC;IACvC,IAAIuE,IAAI,GAAG1G,OAAO,CAACmC,UAAU,CAAC,QAAQ,CAAC;IACvC,IAAIwE,gBAAgB,GAAGrH,gBAAgB,CAACsH,GAAG,CAAC3D,IAAI,EAAEyD,IAAI,CAAC;IACvD,IAAIC,gBAAgB,IAAI,IAAI,IAAI,QAAQ,CAAC7D,IAAI,CAAC4D,IAAI,CAAC,EAAE;MACjDC,gBAAgB,GAAGrH,gBAAgB,CAACsH,GAAG,CAAC3D,IAAI,EAAEyD,IAAI,CAACG,SAAS,CAAC,CAAC,CAAC,CAAC;IACpE;IAEA,IAAIF,gBAAgB,IAAI,IAAI,EAAE;MAC1B,OAAOjF,uBAAuB,CAAC,CAAC/B,OAAO,CACnC,kEAAkE,GAAI+G,IAAI,GAAG,WAAW,GAAGzD,IAC/F,CAAC,CAAC,CAAC;IACP,CAAC,MAAM;MACH,OAAOiC,aAAa,CAAC,IAAIzF,SAAS,CAACqH,IAAI,CAACH,gBAAgB,CAACI,MAAM,CAAC,CAAC;IACrE;EACJ;EAEA,SAASC,mBAAmBA,CAACC,QAAQ,EAAE;IACnC,OAAO,UAASjH,OAAO,EAAE;MACrB,IAAIkH,MAAM,GAAGlH,OAAO,CAACmC,UAAU,CAAC,MAAM,CAAC;MACvC,OAAO+C,aAAa,CAAC,IAAIzF,SAAS,CAAC0H,aAAa,CAAC;QAC7CF,QAAQ,EAAEA,QAAQ;QAClBC,MAAM,EAAEA;MACZ,CAAC,CAAC,CAAC;IACP,CAAC;EACL;EAEA,SAASE,oBAAoBA,CAACpH,OAAO,EAAE;IACnC,OAAOkF,aAAa,CAACzF,SAAS,CAAC4H,gBAAgB,CAAC;MAC5CC,SAAS,EAAEtH,OAAO,CAACmC,UAAU,CAAC,MAAM;IACxC,CAAC,CAAC,CAAC;EACP;EAEA,SAASoF,iBAAiBA,CAACvH,OAAO,EAAE;IAChC,OAAOE,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC;EAC5C;EAEA,IAAItG,iBAAiB,GAAG;IACpB,KAAK,EAAE,SAAAuG,CAASzH,OAAO,EAAE;MACrB,IAAI0H,0BAA0B,GAAG1H,OAAO,CAACkC,YAAY,CAAC,OAAO,CAAC;MAE9D,IAAIyF,SAAS,GAAG,CAAC,CAACD,0BAA0B,CACvCxF,YAAY,CAAC,OAAO,CAAC,CACrBkB,KAAK,CAAC,OAAO,CAAC;MAEnB,IAAIuE,SAAS,EAAE;QACX3H,OAAO,CAACwH,QAAQ,CAACI,OAAO,CAAC,UAASC,KAAK,EAAE;UACrCvH,wBAAwB,CAACoE,IAAI,CAACmD,KAAK,CAAC;QACxC,CAAC,CAAC;QACF,OAAOlG,WAAW,CAAC,CAAC;MACxB,CAAC,MAAM;QACH,IAAImG,WAAW,GAAG9H,OAAO,CAACwH,QAAQ;QAClC,IAAIlH,wBAAwB,CAACyH,MAAM,GAAG,CAAC,EAAE;UACrCD,WAAW,GAAGxH,wBAAwB,CAAC0H,MAAM,CAACF,WAAW,CAAC;UAC1DxH,wBAAwB,GAAG,EAAE;QACjC;QACA,OAAO2H,UAAU,CAACnH,GAAG,CACjBc,uBAAuB,CAAC8F,0BAA0B,CAAC,EACnDxH,eAAe,CAAC4H,WAAW,CAAC,EAC5B,UAASI,UAAU,EAAEV,QAAQ,EAAE;UAC3B,OAAO,IAAI/H,SAAS,CAAC0I,SAAS,CAACX,QAAQ,EAAEU,UAAU,CAAC;QACxD,CACJ,CAAC,CAACE,WAAW,CAAC,CAAC;MACnB;IACJ,CAAC;IACD,KAAK,EAAE,SAAAC,CAASrI,OAAO,EAAE;MACrB,OAAOiI,UAAU,CAACnH,GAAG,CACjB4B,iBAAiB,CAAC1C,OAAO,CAACkC,YAAY,CAAC,OAAO,CAAC,CAAC,EAChDhC,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC,EACjC,UAASU,UAAU,EAAEV,QAAQ,EAAE;QAC3B,IAAIc,gBAAgB,GAAG/C,uBAAuB,CAAC,CAAC;QAChD,IAAI+C,gBAAgB,KAAK,IAAI,EAAE;UAC3Bd,QAAQ,GAAG,CAAC,IAAI/H,SAAS,CAAC8I,SAAS,CAACf,QAAQ,EAAEc,gBAAgB,CAAC,CAAC;QACpE;QAEA,OAAO,IAAI7I,SAAS,CAAC+I,GAAG,CAAChB,QAAQ,EAAEU,UAAU,CAAC;MAClD,CACJ,CAAC;IACL,CAAC;IACD,WAAW,EAAErD,WAAW;IACxB,aAAa,EAAE0B,aAAa;IAC5B,KAAK,EAAE,SAAAkC,CAASzI,OAAO,EAAE;MACrB,OAAOkF,aAAa,CAAC,IAAIzF,SAAS,CAACqH,IAAI,CAAC9G,OAAO,CAACwG,IAAI,CAAC,CAAC,CAAC,CAAC;IAC5D,CAAC;IACD,OAAO,EAAE,SAAAkC,CAAS1I,OAAO,EAAE;MACvB,OAAOkF,aAAa,CAAC,IAAIzF,SAAS,CAACkJ,GAAG,CAAC,CAAC,CAAC;IAC7C,CAAC;IACD,iBAAiB,EAAE,SAAAC,CAAA,EAAW;MAC1B,OAAO1D,aAAa,CAAC,IAAIzF,SAAS,CAACqH,IAAI,CAAC,QAAQ,CAAC,CAAC;IACtD,CAAC;IACD,cAAc,EAAE,SAAA+B,CAAS7I,OAAO,EAAE;MAC9B,OAAOkF,aAAa,CAAC,IAAIzF,SAAS,CAACqH,IAAI,CAAC,QAAQ,CAAC,CAAC;IACtD,CAAC;IACD,OAAO,EAAEL,UAAU;IACnB,aAAa,EAAE,SAAAqC,CAAS9I,OAAO,EAAE;MAC7B,IAAI+I,cAAc,GAAG/I,OAAO,CAACmC,UAAU,CAAC,MAAM,CAAC;MAC/C,IAAIgE,MAAM,GAAGnG,OAAO,CAACmC,UAAU,CAAC,UAAU,CAAC;MAC3C,OAAOjC,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC,CAAC1G,GAAG,CAAC,UAAS0G,QAAQ,EAAE;QAC5D,SAASwB,MAAMA,CAAClJ,OAAO,EAAE;UACrB,IAAImJ,WAAW,GAAGjJ,OAAO,CAACmC,UAAU,CAAC,YAAY,CAAC,IAAI,IAAI;UAE1D,OAAO,IAAI1C,SAAS,CAAC8I,SAAS,CAC1Bf,QAAQ,EACRhI,CAAC,CAAC0J,MAAM,CAAC;YAACD,WAAW,EAAEA;UAAW,CAAC,EAAEnJ,OAAO,CAChD,CAAC;QACL;QAEA,IAAIiJ,cAAc,EAAE;UAChB,IAAI9C,IAAI,GAAG1F,aAAa,CAAC4I,0BAA0B,CAACJ,cAAc,CAAC;UACnE,IAAI5C,MAAM,EAAE;YACRF,IAAI,GAAGpG,IAAI,CAACuJ,eAAe,CAACnD,IAAI,EAAEE,MAAM,CAAC;UAC7C;UACA,OAAO6C,MAAM,CAAC;YAAC/C,IAAI,EAAEA;UAAI,CAAC,CAAC;QAC/B,CAAC,MAAM,IAAIE,MAAM,EAAE;UACf,OAAO6C,MAAM,CAAC;YAAC7C,MAAM,EAAEA;UAAM,CAAC,CAAC;QACnC,CAAC,MAAM;UACH,OAAOqB,QAAQ;QACnB;MACJ,CAAC,CAAC;IACN,CAAC;IACD,OAAO,EAAE6B,SAAS;IAClB,MAAM,EAAEC,YAAY;IACpB,MAAM,EAAEC,aAAa;IACrB,qBAAqB,EAAEvC,mBAAmB,CAAC,UAAU,CAAC;IACtD,oBAAoB,EAAEA,mBAAmB,CAAC,SAAS,CAAC;IACpD,oBAAoB,EAAEI,oBAAoB;IAC1C,MAAM,EAAE,SAAAoC,CAASxJ,OAAO,EAAE;MACtB,IAAIyJ,SAAS,GAAGzJ,OAAO,CAACmC,UAAU,CAAC,QAAQ,CAAC;MAC5C,IAAIsH,SAAS,IAAI,IAAI,IAAIA,SAAS,KAAK,cAAc,EAAE;QACnD,OAAOvE,aAAa,CAACzF,SAAS,CAACiK,SAAS,CAAC;MAC7C,CAAC,MAAM,IAAID,SAAS,KAAK,MAAM,EAAE;QAC7B,OAAOvE,aAAa,CAACzF,SAAS,CAACkK,SAAS,CAAC;MAC7C,CAAC,MAAM,IAAIF,SAAS,KAAK,QAAQ,EAAE;QAC/B,OAAOvE,aAAa,CAACzF,SAAS,CAACmK,WAAW,CAAC;MAC/C,CAAC,MAAM;QACH,OAAOlI,uBAAuB,CAAC,CAAC/B,OAAO,CAAC,0BAA0B,GAAG8J,SAAS,CAAC,CAAC,CAAC;MACrF;IACJ,CAAC;IACD,iBAAiB,EAAE,SAAAI,CAAS7J,OAAO,EAAC;MAChC,IAAImB,IAAI,GAAGnB,OAAO,CAACmC,UAAU,CAAC,QAAQ,CAAC;MACvC,IAAIhB,IAAI,KAAK,SAAS,EAAE;QACpB,OAAOQ,WAAW,CAAC,CAAC;MACxB,CAAC,MAAM;QACH,OAAOuD,aAAa,CAAC,IAAIzF,SAAS,CAACqK,aAAa,CAAC;UAAC3I,IAAI,EAAEA;QAAI,CAAC,CAAC,CAAC;MACnE;IACJ,CAAC;IAED,qBAAqB,EAAE,SAAA4I,CAAS/J,OAAO,EAAE;MACrC,OAAOuH,iBAAiB,CAACvH,OAAO,CAACoD,KAAK,CAAC,aAAa,CAAC,CAAC;IAC1D,CAAC;IAED,OAAO,EAAE,SAAA4G,CAAShK,OAAO,EAAE;MACvB,IAAImF,QAAQ,GAAGnF,OAAO,CACjBkC,YAAY,CAAC,SAAS,CAAC,CACvBkB,KAAK,CAAC,iBAAiB,CAAC;MAE7B,IAAI+B,QAAQ,EAAE;QACV,IAAImB,cAAc,GAAGnB,QAAQ,CAAC/B,KAAK,CAAC,gBAAgB,CAAC;QACrD,IAAI6G,SAAS,GAAG,CAAC,CAAC3D,cAAc,IAAIvC,yBAAyB,CACzDuC,cAAc,CAACnE,UAAU,CAAC,YAAY,CAC1C,CAAC;QACD,OAAO+C,aAAa,CAACzF,SAAS,CAAC0F,QAAQ,CAAC;UACpCC,OAAO,EAAE6E;QACb,CAAC,CAAC,CAAC;MACP,CAAC,MAAM;QACH,OAAO/J,eAAe,CAACF,OAAO,CAACkC,YAAY,CAAC,cAAc,CAAC,CAACsF,QAAQ,CAAC;MACzE;IACJ,CAAC;IAED,OAAO,EAAED,iBAAiB;IAC1B,UAAU,EAAEA,iBAAiB;IAC7B,YAAY,EAAEA,iBAAiB;IAC/B,WAAW,EAAEA,iBAAiB;IAC9B,QAAQ,EAAE,SAAA2C,CAASlK,OAAO,EAAE;MACxB,OAAOuH,iBAAiB,CAACvH,OAAO,CAAC,CAACmK,OAAO,CAAC,CAAC;IAC/C,CAAC;IACD,aAAa,EAAE5C,iBAAiB;IAChC,SAAS,EAAEA,iBAAiB;IAC5B,WAAW,EAAEA,iBAAiB;IAC9B,eAAe,EAAEA,iBAAiB;IAClC,WAAW,EAAE6C,kBAAkB;IAC/B,WAAW,EAAEA,kBAAkB;IAC/B,aAAa,EAAEC,aAAa;IAC5B,SAAS,EAAE9C,iBAAiB;IAC5B,QAAQ,EAAEA;EACd,CAAC;EAED,OAAO;IACHxH,cAAc,EAAEA,cAAc;IAC9BG,eAAe,EAAEA;EACrB,CAAC;EAGD,SAASmJ,SAASA,CAACrJ,OAAO,EAAE;IACxB,IAAIsK,gBAAgB,GAAGC,mBAAmB,CAACvK,OAAO,CAACkC,YAAY,CAAC,SAAS,CAAC,CAAC;IAC3E,OAAOhC,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC,CACnCgD,OAAO,CAACC,iBAAiB,CAAC,CAC1BD,OAAO,CAAC,UAAShD,QAAQ,EAAE;MACxB,OAAO8C,gBAAgB,CAACxJ,GAAG,CAAC,UAASoH,UAAU,EAAE;QAC7C,OAAOzI,SAAS,CAACiL,KAAK,CAAClD,QAAQ,EAAEU,UAAU,CAAC;MAChD,CAAC,CAAC;IACN,CAAC,CAAC;EACV;EAEA,SAASqC,mBAAmBA,CAACvK,OAAO,EAAE;IAClC,OAAOmE,cAAc,CAACnE,OAAO,CAAC,CAACc,GAAG,CAAC,UAASgB,KAAK,EAAE;MAC/C,OAAO;QACHC,OAAO,EAAED,KAAK,CAACC,OAAO;QACtBC,SAAS,EAAEF,KAAK,CAACX;MACrB,CAAC;IACL,CAAC,CAAC;EACN;EAEA,SAASmI,YAAYA,CAACtJ,OAAO,EAAE;IAC3B,IAAIkI,UAAU,GAAGlI,OAAO,CAACkC,YAAY,CAAC,QAAQ,CAAC;IAC/C,IAAIyI,QAAQ,GAAG,CAAC,CAACzC,UAAU,CAAC9E,KAAK,CAAC,aAAa,CAAC;IAChD,OAAOlD,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC,CAAC1G,GAAG,CAAC,UAAS0G,QAAQ,EAAE;MAC5D,OAAO/H,SAAS,CAACmL,QAAQ,CAACpD,QAAQ,EAAE;QAACmD,QAAQ,EAAEA;MAAQ,CAAC,CAAC;IAC7D,CAAC,CAAC;EACN;EAEA,SAASpB,aAAaA,CAACvJ,OAAO,EAAE;IAC5B,OAAOE,eAAe,CAACF,OAAO,CAACwH,QAAQ,CAAC,CAAC1G,GAAG,CAAC,UAAS0G,QAAQ,EAAE;MAC5D,IAAIU,UAAU,GAAGlI,OAAO,CAACkC,YAAY,CAAC,QAAQ,CAAC;MAE/C,IAAI2I,QAAQ,GAAG3C,UAAU,CAAChG,YAAY,CAAC,YAAY,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;MACxE,IAAI2I,OAAO,GAAGD,QAAQ,GAAG9H,QAAQ,CAAC8H,QAAQ,EAAE,EAAE,CAAC,GAAG,CAAC;MAEnD,IAAIE,IAAI,GAAGtL,SAAS,CAACuL,SAAS,CAACxD,QAAQ,EAAE;QAACsD,OAAO,EAAEA;MAAO,CAAC,CAAC;MAC5DC,IAAI,CAACE,OAAO,GAAGC,UAAU,CAAChD,UAAU,CAAC;MACrC,OAAO6C,IAAI;IACf,CAAC,CAAC;EACN;EAEA,SAASG,UAAUA,CAAChD,UAAU,EAAE;IAC5B,IAAIlI,OAAO,GAAGkI,UAAU,CAAC9E,KAAK,CAAC,UAAU,CAAC;IAC1C,IAAIpD,OAAO,EAAE;MACT,IAAImL,GAAG,GAAGnL,OAAO,CAACmC,UAAU,CAAC,OAAO,CAAC;MACrC,OAAOgJ,GAAG,KAAK,UAAU,IAAI,CAACA,GAAG;IACrC,CAAC,MAAM;MACH,OAAO,IAAI;IACf;EACJ;EAEA,SAASV,iBAAiBA,CAACW,IAAI,EAAE;IAC7B,IAAIC,iBAAiB,GAAG7L,CAAC,CAAC8L,GAAG,CAACF,IAAI,EAAE,UAASG,GAAG,EAAE;MAC9C,OAAOA,GAAG,CAACvK,IAAI,KAAKvB,SAAS,CAAC+L,KAAK,CAACC,QAAQ;IAChD,CAAC,CAAC;IACF,IAAIJ,iBAAiB,EAAE;MACnB,OAAOzG,yBAAyB,CAACwG,IAAI,EAAE,CAACzL,OAAO,CAC3C,oEACJ,CAAC,CAAC,CAAC;IACP;IACA,IAAI+L,kBAAkB,GAAGlM,CAAC,CAAC8L,GAAG,CAACF,IAAI,EAAE,UAASG,GAAG,EAAE;MAC/C,OAAO/L,CAAC,CAAC8L,GAAG,CAACC,GAAG,CAAC/D,QAAQ,EAAE,UAASuD,IAAI,EAAE;QACtC,OAAOA,IAAI,CAAC/J,IAAI,KAAKvB,SAAS,CAAC+L,KAAK,CAACG,SAAS;MAClD,CAAC,CAAC;IACN,CAAC,CAAC;IACF,IAAID,kBAAkB,EAAE;MACpB,OAAO9G,yBAAyB,CAACwG,IAAI,EAAE,CAACzL,OAAO,CAC3C,yEACJ,CAAC,CAAC,CAAC;IACP;IAEA,IAAIiM,OAAO,GAAG,CAAC,CAAC;IAEhBR,IAAI,CAACxD,OAAO,CAAC,UAAS2D,GAAG,EAAE;MACvB,IAAIM,SAAS,GAAG,CAAC;MACjBN,GAAG,CAAC/D,QAAQ,CAACI,OAAO,CAAC,UAASmD,IAAI,EAAE;QAChC,IAAIA,IAAI,CAACE,OAAO,IAAIW,OAAO,CAACC,SAAS,CAAC,EAAE;UACpCD,OAAO,CAACC,SAAS,CAAC,CAACC,OAAO,EAAE;QAChC,CAAC,MAAM;UACHF,OAAO,CAACC,SAAS,CAAC,GAAGd,IAAI;UACzBA,IAAI,CAACE,OAAO,GAAG,KAAK;QACxB;QACAY,SAAS,IAAId,IAAI,CAACD,OAAO;MAC7B,CAAC,CAAC;IACN,CAAC,CAAC;IAEFM,IAAI,CAACxD,OAAO,CAAC,UAAS2D,GAAG,EAAE;MACvBA,GAAG,CAAC/D,QAAQ,GAAG+D,GAAG,CAAC/D,QAAQ,CAAC9B,MAAM,CAAC,UAASqF,IAAI,EAAE;QAC9C,OAAO,CAACA,IAAI,CAACE,OAAO;MACxB,CAAC,CAAC;MACFM,GAAG,CAAC/D,QAAQ,CAACI,OAAO,CAAC,UAASmD,IAAI,EAAE;QAChC,OAAOA,IAAI,CAACE,OAAO;MACvB,CAAC,CAAC;IACN,CAAC,CAAC;IAEF,OAAO/F,aAAa,CAACkG,IAAI,CAAC;EAC9B;EAEA,SAAShB,kBAAkBA,CAACpK,OAAO,EAAE;IACjC,IAAI+L,KAAK,GAAG/L,OAAO,CACdgM,oBAAoB,CAAC,WAAW,CAAC,CACjCA,oBAAoB,CAAC,eAAe,CAAC,CACrCA,oBAAoB,CAAC,SAAS,CAAC,CAC/BA,oBAAoB,CAAC,cAAc,CAAC,CACpCA,oBAAoB,CAAC,QAAQ,CAAC;IAEnC,OAAOjL,cAAc,CAACgL,KAAK,CAACjL,GAAG,CAACmL,QAAQ,CAACC,IAAI,CAAC,IAAI,EAAElM,OAAO,CAAC,CAAC,CAAC;EAClE;EAEA,SAASiM,QAAQA,CAACjM,OAAO,EAAEmM,IAAI,EAAE;IAC7B,IAAIjE,UAAU,GAAGlI,OAAO,CAACoD,KAAK,CAAC,UAAU,CAAC,CAACjB,UAAU;IACrD,IAAIiK,OAAO,GAAGC,OAAO,CAACnE,UAAU,CAACoE,KAAK,CAAC,GAAGpE,UAAU,CAACqE,KAAK,GAAGrE,UAAU,CAACoE,KAAK;IAC7E,IAAIE,aAAa,GAAGC,iBAAiB,CAACN,IAAI,CAAC;IAC3C,IAAIK,aAAa,KAAK,IAAI,EAAE;MACxB,OAAO9K,uBAAuB,CAAC,CAAC/B,OAAO,CAAC,8CAA8C,CAAC,CAAC,CAAC;IAC7F,CAAC,MAAM;MACH,OAAO+M,SAAS,CAACF,aAAa,EAAEJ,OAAO,CAAC;IAC5C;EACJ;EAEA,SAASC,OAAOA,CAACxI,KAAK,EAAE;IACpB,OAAOA,KAAK,IAAI,IAAI,IAAI,OAAO,CAACf,IAAI,CAACe,KAAK,CAAC;EAC/C;EAEA,SAAS4I,iBAAiBA,CAACN,IAAI,EAAE;IAC7B,IAAIQ,mBAAmB,GAAGR,IAAI,CAAChK,UAAU,CAAC,SAAS,CAAC;IACpD,IAAIyK,kBAAkB,GAAGT,IAAI,CAAChK,UAAU,CAAC,QAAQ,CAAC;IAClD,IAAIwK,mBAAmB,EAAE;MACrB,OAAOE,qBAAqB,CAACF,mBAAmB,CAAC;IACrD,CAAC,MAAM,IAAIC,kBAAkB,EAAE;MAC3B,IAAIE,SAAS,GAAGvM,aAAa,CAAC4I,0BAA0B,CAACyD,kBAAkB,CAAC;MAC5E,OAAO;QACHG,IAAI,EAAED,SAAS;QACfE,IAAI,EAAEtM,KAAK,CAACsM,IAAI,CAACd,IAAI,CAACxL,KAAK,EAAEoM,SAAS;MAC1C,CAAC;IACL,CAAC,MAAM;MACH,OAAO,IAAI;IACf;EACJ;EAEA,SAASzC,aAAaA,CAACrK,OAAO,EAAE;IAC5B,IAAI+I,cAAc,GAAG/I,OAAO,CAACmC,UAAU,CAAC,MAAM,CAAC;IAE/C,IAAI4G,cAAc,EAAE;MAChB,OAAO2D,SAAS,CACZG,qBAAqB,CAAC9D,cAAc,CAAC,EACrC/I,OAAO,CAACmC,UAAU,CAAC,SAAS,CAAC,CAAC;IACtC,CAAC,MAAM;MACH,OAAOT,uBAAuB,CAAC,CAAC/B,OAAO,CAAC,6DAA6D,CAAC,CAAC,CAAC;IAC5G;EACJ;EAEA,SAASkN,qBAAqBA,CAAC9D,cAAc,EAAE;IAC3C,IAAIgE,IAAI,GAAGlN,IAAI,CAACoN,iBAAiB,CAAC,MAAM,EAAE1M,aAAa,CAAC4I,0BAA0B,CAACJ,cAAc,CAAC,CAAC;IACnG,OAAO;MACHgE,IAAI,EAAEA,IAAI;MACVC,IAAI,EAAEvM,QAAQ,CAACuM,IAAI,CAACd,IAAI,CAACzL,QAAQ,EAAEsM,IAAI;IAC3C,CAAC;EACL;EAEA,SAASL,SAASA,CAACQ,SAAS,EAAEd,OAAO,EAAE;IACnC,IAAIe,WAAW,GAAG3M,YAAY,CAAC4M,eAAe,CAACF,SAAS,CAACH,IAAI,CAAC;IAE9D,IAAIM,KAAK,GAAG5N,SAAS,CAAC6N,KAAK,CAAC;MACxBZ,SAAS,EAAEQ,SAAS,CAACF,IAAI;MACzBZ,OAAO,EAAEA,OAAO;MAChBe,WAAW,EAAEA;IACjB,CAAC,CAAC;IACF,IAAII,QAAQ,GAAGC,mBAAmB,CAACL,WAAW,CAAC,GAC3C,EAAE,GAAGxN,OAAO,CAAC,gBAAgB,GAAGwN,WAAW,GAAG,yCAAyC,CAAC;IAC5F,OAAOvI,yBAAyB,CAACyI,KAAK,EAAEE,QAAQ,CAAC;EACrD;EAEA,SAAS5I,qBAAqBA,CAAC3D,IAAI,EAAEe,OAAO,EAAE;IAC1C,OAAOpC,OAAO,CACVqB,IAAI,GAAG,iBAAiB,GAAGe,OAAO,GAAG,iDAAiD,CAAC;EAC/F;AACJ;AAGA,SAAS1C,uBAAuBA,CAAC0C,OAAO,EAAE/B,OAAO,EAAEW,SAAS,EAAE;EAC1D,IAAI8M,KAAK,GAAGzN,OAAO,CAACkC,YAAY,CAAC,QAAQ,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;EAC9D,IAAIuL,KAAK,GAAG1N,OAAO,CAACkC,YAAY,CAAC,SAAS,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;EAC/D,IAAIsL,KAAK,KAAK3J,SAAS,IAAI4J,KAAK,KAAK5J,SAAS,EAAE;IAC5C,OAAOnD,SAAS,CAACgN,SAAS,CAACD,KAAK,EAAED,KAAK,CAAC;EAC5C;EAEA,IAAI1L,OAAO,IAAI,IAAI,EAAE;IACjB,IAAI6L,cAAc,GAAGjN,SAAS,CAACkN,2BAA2B,CAAC9L,OAAO,CAAC;IACnE,IAAI6L,cAAc,IAAI,IAAI,EAAE;MACxB,OAAOA,cAAc;IACzB;EACJ;EAEA,OAAO,IAAI;AACf;AAEA,IAAIJ,mBAAmB,GAAG;EACtB,WAAW,EAAE,IAAI;EACjB,WAAW,EAAE,IAAI;EACjB,YAAY,EAAE,IAAI;EAClB,eAAe,EAAE,IAAI;EACrB,YAAY,EAAE;AAClB,CAAC;AAED,IAAIhM,cAAc,GAAG;EACjB,kBAAkB,EAAE,IAAI;EACxB,UAAU,EAAE,IAAI;EAChB,aAAa,EAAE,IAAI;EACnB,iBAAiB,EAAE,IAAI;EACvB,eAAe,EAAE,IAAI;EACrB,UAAU,EAAE,IAAI;EAChB,YAAY,EAAE,IAAI;EAClB,yBAAyB,EAAE,IAAI;EAC/B,qBAAqB,EAAE,IAAI;EAC3B,mBAAmB,EAAE,IAAI;EACzB,OAAO,EAAE,IAAI;EACb,eAAe,EAAE,IAAI;EACrB,cAAc,EAAE,IAAI;EACpB,OAAO,EAAE,IAAI;EACb,OAAO,EAAE,IAAI;EACb,SAAS,EAAE,IAAI;EACf,WAAW,EAAE,IAAI;EACjB,QAAQ,EAAE,IAAI;EACd,QAAQ,EAAE;AACd,CAAC;AAED,SAASE,uBAAuBA,CAAC8C,QAAQ,EAAE;EACvC,OAAO,IAAIyD,UAAU,CAAC,IAAI,EAAE,IAAI,EAAEzD,QAAQ,CAAC;AAC/C;AAEA,SAAS7C,WAAWA,CAAA,EAAG;EACnB,OAAO,IAAIsG,UAAU,CAAC,IAAI,CAAC;AAC/B;AAEA,SAAS/C,aAAaA,CAAClF,OAAO,EAAE;EAC5B,OAAO,IAAIiI,UAAU,CAACjI,OAAO,CAAC;AAClC;AAEA,SAAS4E,yBAAyBA,CAAC5E,OAAO,EAAEwE,QAAQ,EAAE;EAClD,OAAO,IAAIyD,UAAU,CAACjI,OAAO,EAAE,IAAI,EAAEwE,QAAQ,CAAC;AAClD;AAEA,SAASyD,UAAUA,CAACjI,OAAO,EAAE8N,KAAK,EAAEtJ,QAAQ,EAAE;EAC1C,IAAI,CAACX,KAAK,GAAG7D,OAAO,IAAI,EAAE;EAC1B,IAAI,CAAC8N,KAAK,GAAGA,KAAK,IAAI,EAAE;EACxB,IAAI,CAACC,OAAO,GAAG,IAAIrO,MAAM,CAAC;IACtBM,OAAO,EAAE,IAAI,CAAC6D,KAAK;IACnBiK,KAAK,EAAEA;EACX,CAAC,EAAEtJ,QAAQ,CAAC;EACZ,IAAI,CAACA,QAAQ,GAAG,IAAI,CAACuJ,OAAO,CAACvJ,QAAQ;AACzC;AAEAyD,UAAU,CAAC5G,SAAS,CAAC8I,OAAO,GAAG,YAAW;EACtC,OAAO,IAAIlC,UAAU,CAAC,IAAI,EAAE+F,YAAY,CAAC,IAAI,CAACF,KAAK,EAAE,IAAI,CAACjK,KAAK,CAAC,EAAE,IAAI,CAACW,QAAQ,CAAC;AACpF,CAAC;AAEDyD,UAAU,CAAC5G,SAAS,CAAC+G,WAAW,GAAG,YAAW;EAC1C,IAAI0F,KAAK,GAAG,IAAI,CAACA,KAAK;EACtB,IAAIA,KAAK,IAAIA,KAAK,CAAC/F,MAAM,EAAE;IACvB,OAAO,IAAIE,UAAU,CAAC+F,YAAY,CAAC,IAAI,CAACnK,KAAK,EAAEiK,KAAK,CAAC,EAAE,IAAI,EAAE,IAAI,CAACtJ,QAAQ,CAAC;EAC/E,CAAC,MAAM;IACH,OAAO,IAAI;EACf;AACJ,CAAC;AAEDyD,UAAU,CAAC5G,SAAS,CAACP,GAAG,GAAG,UAASmN,IAAI,EAAE;EACtC,IAAIC,MAAM,GAAG,IAAI,CAACH,OAAO,CAACjN,GAAG,CAAC,UAAS+C,KAAK,EAAE;IAC1C,OAAOoK,IAAI,CAACpK,KAAK,CAAC7D,OAAO,CAAC;EAC9B,CAAC,CAAC;EACF,OAAO,IAAIiI,UAAU,CAACiG,MAAM,CAACrK,KAAK,EAAE,IAAI,CAACiK,KAAK,EAAEI,MAAM,CAAC1J,QAAQ,CAAC;AACpE,CAAC;AAEDyD,UAAU,CAAC5G,SAAS,CAACmJ,OAAO,GAAG,UAASyD,IAAI,EAAE;EAC1C,IAAIC,MAAM,GAAG,IAAI,CAACH,OAAO,CAACvD,OAAO,CAAC,UAAS3G,KAAK,EAAE;IAC9C,OAAOoK,IAAI,CAACpK,KAAK,CAAC7D,OAAO,CAAC,CAAC+N,OAAO;EACtC,CAAC,CAAC;EACF,OAAO,IAAI9F,UAAU,CAACiG,MAAM,CAACrK,KAAK,CAAC7D,OAAO,EAAEgO,YAAY,CAAC,IAAI,CAACF,KAAK,EAAEI,MAAM,CAACrK,KAAK,CAACiK,KAAK,CAAC,EAAEI,MAAM,CAAC1J,QAAQ,CAAC;AAC9G,CAAC;AAEDyD,UAAU,CAACnH,GAAG,GAAG,UAASsC,KAAK,EAAE+K,MAAM,EAAEF,IAAI,EAAE;EAC3C,OAAO,IAAIhG,UAAU,CACjBgG,IAAI,CAAC7K,KAAK,CAACS,KAAK,EAAEsK,MAAM,CAACtK,KAAK,CAAC,EAC/BmK,YAAY,CAAC5K,KAAK,CAAC0K,KAAK,EAAEK,MAAM,CAACL,KAAK,CAAC,EACvC1K,KAAK,CAACoB,QAAQ,CAACwD,MAAM,CAACmG,MAAM,CAAC3J,QAAQ,CACzC,CAAC;AACL,CAAC;AAED,SAASzD,cAAcA,CAACF,OAAO,EAAE;EAC7B,IAAIqN,MAAM,GAAGxO,MAAM,CAAC0O,OAAO,CAAC5O,CAAC,CAAC6O,KAAK,CAACxN,OAAO,EAAE,SAAS,CAAC,CAAC;EACxD,OAAO,IAAIoH,UAAU,CACjBzI,CAAC,CAAC8O,OAAO,CAAC9O,CAAC,CAAC6O,KAAK,CAACH,MAAM,CAACrK,KAAK,EAAE,SAAS,CAAC,CAAC,EAC3CrE,CAAC,CAACkG,MAAM,CAAClG,CAAC,CAAC8O,OAAO,CAAC9O,CAAC,CAAC6O,KAAK,CAACH,MAAM,CAACrK,KAAK,EAAE,OAAO,CAAC,CAAC,EAAE0K,QAAQ,CAAC,EAC7DL,MAAM,CAAC1J,QACX,CAAC;AACL;AAEA,SAASwJ,YAAYA,CAAC5K,KAAK,EAAE+K,MAAM,EAAE;EACjC,OAAO3O,CAAC,CAAC8O,OAAO,CAAC,CAAClL,KAAK,EAAE+K,MAAM,CAAC,CAAC;AACrC;AAEA,SAASI,QAAQA,CAAC1K,KAAK,EAAE;EACrB,OAAOA,KAAK;AAChB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}